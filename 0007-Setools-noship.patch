From a39d0831d654292fb2a1f7b9ee18ecc9239f610f Mon Sep 17 00:00:00 2001
From: Miroslav Grepl <mgrepl@redhat.com>
Date: Fri, 11 Apr 2014 18:38:34 +0200
Subject: [PATCH 07/11] Setools noship

---
 Makefile.am         | 26 +++-----------------------
 configure.ac        |  2 +-
 man/Makefile.am     | 15 +++------------
 seaudit/Makefile.am | 31 +++----------------------------
 secmds/Makefile.am  | 14 +-------------
 sediff/Makefile.am  | 32 ++------------------------------
 6 files changed, 13 insertions(+), 107 deletions(-)

diff --git a/Makefile.am b/Makefile.am
index 176c8ea..4cac386 100644
--- a/Makefile.am
+++ b/Makefile.am
@@ -78,9 +70,9 @@ install-logwatch:
 	$(MAKE) -C $(top_srcdir)/seaudit install-logwatch
 
 .PHONY: libqpol libapol libpoldiff libsefs libseaudit \
-	apol secmds seaudit sediff sediffx sechecker \
+	apol secmds seaudit sediff sechecker\
 	install-logwatch help \
-	seinfo sesearch indexcon findcon replcon searchcon \
+	seinfo sesearch findcon \
 	packages
 
 seinfo: libqpol libapol
diff --git a/configure.ac b/configure.ac
index 2a5b55b..5b1da5e 100644
--- a/configure.ac
+++ b/configure.ac
@@ -63,7 +63,7 @@ if test ${ac_cv_prog_cc_c99} = "no"; then
 fi
 AC_PROG_CXX
 AC_LANG([C])
-AC_PROG_LIBTOOL
+AC_PROG_RANLIB
 AC_PROG_LN_S
 AC_PROG_LEX
 AC_PROG_YACC
diff --git a/man/Makefile.am b/man/Makefile.am
index 0fafccb..f88e00a 100644
--- a/man/Makefile.am
+++ b/man/Makefile.am
@@ -1,19 +1,10 @@
 if BUILD_GUI
   MAYBEMANS = apol.1 \
-	seaudit.8 seaudit-report.8 \
-	sediffx.1
+	seaudit.8
 endif
 
 EXTRA_DIST=$(man_MANS) apol.1 \
-	seaudit.8 seaudit-report.8.in \
-	sediffx.1
+	seaudit.8
 
-man_MANS = findcon.1 indexcon.1 replcon.1 \
-	sechecker.1 \
-	sediff.1 \
+man_MANS = findcon.1 sediff.1 sechecker.1 \
 	seinfo.1 sesearch.1 $(MAYBEMANS)
-
-seaudit-report.8: seaudit-report.8.in Makefile
-	sed -e 's|\@setoolsdir\@|$(setoolsdir)|g' $< > $@
-
-CLEANFILES = seaudit-report.8
diff --git a/seaudit/Makefile.am b/seaudit/Makefile.am
index 1987c99..3fa4413 100644
--- a/seaudit/Makefile.am
+++ b/seaudit/Makefile.am
@@ -1,5 +1,4 @@
 setoolsdir = @setoolsdir@
-bin_PROGRAMS = seaudit-report
 sbin_PROGRAMS = seaudit
 
 AM_CFLAGS = @DEBUGCFLAGS@ @WARNCFLAGS@ @PROFILECFLAGS@ @SELINUX_CFLAGS@ \
@@ -20,13 +19,10 @@ LDADD = @SELINUX_LIB_FLAG@ @SEAUDIT_LIB_FLAG@ @APOL_LIB_FLAG@ @QPOL_LIB_FLAG@
 dist_setools_DATA = \
 	seaudit.glade \
 	seaudit_help.txt \
-	seaudit-report.conf \
-	seaudit-report.css \
 	seaudit.png seaudit-small.png
 
 nodist_setools_DATA = \
-	dot_seaudit \
-	seaudit-report-service
+	dot_seaudit
 
 seaudit_SOURCES = \
 	filter_view.c filter_view.h \
@@ -50,31 +46,12 @@ seaudit_DEPENDENCIES = $(top_builddir)/libseaudit/src/libseaudit.so \
 dot_seaudit: dot_seaudit.in Makefile
 	sed -e 's|\@setoolsdir\@|$(setoolsdir)|g' $< > $@
 
-seaudit_report_SOURCES = seaudit-report.c
-seaudit_report_DEPENDENCIES = $(top_builddir)/libseaudit/src/libseaudit.so \
-                              $(top_builddir)/libapol/src/libapol.so \
-                              $(top_builddir)/libqpol/src/libqpol.so
-
 logwatch = $(DESTDIR)/etc/logwatch
 LOGWATCH_GROUP = $(logwatch)/conf/logfiles
 LOGWATCH_SERVICE = $(logwatch)/conf/services
 LOGWATCH_FILTER = $(logwatch)/scripts/services
 
-dist_noinst_DATA = dot_seaudit.in \
-	seaudit-report-group.conf \
-        seaudit-report-service.conf \
-        seaudit-report-service.in
-
-seaudit-report-service: seaudit-report-service.in Makefile
-	sed -e 's|\@bindir\@|$(bindir)|g' $< > $@
-
-install-logwatch: $(dist_noinst_DATA) seaudit-report-service
-	mkdir -p -- $(LOGWATCH_GROUP)
-	install -m 644 seaudit-report-group.conf $(LOGWATCH_GROUP)
-	mkdir -p -- $(LOGWATCH_SERVICE)
-	install -m 644 seaudit-report-service.conf $(LOGWATCH_SERVICE)
-	mkdir -p -- $(LOGWATCH_FILTER)
-	install -m 755 seaudit-report-service $(LOGWATCH_FILTER)
+dist_noinst_DATA = dot_seaudit.in
 
 $(top_builddir)/libapol/src/libapol.so:
 	$(MAKE) -C $(top_builddir)/libapol/src $(notdir $@)
@@ -85,6 +62,4 @@ $(top_builddir)/libqpol/src/libqpol.so:
 $(top_builddir)/libsefs/src/libsefs.so:
 	$(MAKE) -C $(top_builddir)/libsefs/src $(notdir $@)
 
-.PHONY: install-logwatch
-
-CLEANFILES = dot_seaudit seaudit-report-service
+CLEANFILES = dot_seaudit
diff --git a/secmds/Makefile.am b/secmds/Makefile.am
index ddc88b1..7fa4364 100644
--- a/secmds/Makefile.am
+++ b/secmds/Makefile.am
@@ -1,6 +1,6 @@
 # various setools command line tools
 
-bin_PROGRAMS = seinfo sesearch findcon replcon indexcon
+bin_PROGRAMS = seinfo sesearch findcon
 
 # These are for indexcon so that it is usable on machines without setools
 STATICLIBS = ../libsefs/src/libsefs.a ../libapol/src/libapol.a ../libqpol/src/libqpol.a -lsqlite3
diff --git a/sediff/Makefile.am b/sediff/Makefile.am
index 3f53cd3..2d9ce84 100644
--- a/sediff/Makefile.am
+++ b/sediff/Makefile.am
@@ -1,13 +1,6 @@
 setoolsdir = @setoolsdir@
 
-dist_setools_DATA = sediff_help.txt sediffx.glade \
-	sediffx.png sediffx-small.png
-
-if BUILD_GUI
-  MAYBE_SEDIFFX = sediffx
-endif
-
-bin_PROGRAMS = sediff $(MAYBE_SEDIFFX)
+bin_PROGRAMS = sediff
 
 AM_CFLAGS = @DEBUGCFLAGS@ @WARNCFLAGS@ @PROFILECFLAGS@ @SELINUX_CFLAGS@ \
 	@QPOL_CFLAGS@ @APOL_CFLAGS@ @POLDIFF_CFLAGS@
@@ -15,14 +8,7 @@ AM_LDFLAGS = @DEBUGLDFLAGS@ @WARNLDFLAGS@ @PROFILELDFLAGS@
 
 LDADD = @SELINUX_LIB_FLAG@ @POLDIFF_LIB_FLAG@ @APOL_LIB_FLAG@ @QPOL_LIB_FLAG@
 
-sediff_CFLAGS = $(AM_CFLAGS)
-sediffx_CFLAGS = $(AM_CFLAGS) \
-	@GTK_CFLAGS@ @PIXBUF_CFLAGS@ @GLADE_CFLAGS@ @GTHREAD_CFLAGS@
-
-# need the -rdynamic flag below - glade uses dlopen() upon sediffx callbacks
-sediffx_LDFLAGS = $(AM_LDFLAGS) \
-	@GTK_LIBS@ @PIXBUF_LIBS@ @GLADE_LIBS@ @GTHREAD_LIBS@ @XML_LIBS@ \
-	-rdynamic
+sediff_CFLAGS = $(AM_CFLAGS) 
 
 DEPENDENCIES = $(top_builddir)/libpoldiff/src/libpoldiff.so \
 	$(top_builddir)/libapol/src/libapol.so \
@@ -30,20 +16,6 @@ DEPENDENCIES = $(top_builddir)/libpoldiff/src/libpoldiff.so \
 
 sediff_SOURCES = sediff.c
 
-sediffx_SOURCES = \
-	find_dialog.c find_dialog.h \
-	open_policies_dialog.c open_policies_dialog.h \
-	policy_view.c policy_view.h \
-	progress.c progress.h \
-	remap_types_dialog.c remap_types_dialog.h \
-	result_item.c result_item.h \
-	result_item_render.c result_item_render.h \
-	results.c results.h \
-	select_diff_dialog.c select_diff_dialog.h \
-	toplevel.c toplevel.h \
-	utilgui.c utilgui.h \
-	sediffx.c sediffx.h
-
 $(top_builddir)/libpoldiff/src/libpoldiff.so:
 	$(MAKE) -C $(top_builddir)/libpoldiff/src $(notdir $@)
 
-- 
1.8.5.3

